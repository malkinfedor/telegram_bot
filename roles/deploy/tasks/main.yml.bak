- name: Create asusin user and his home folder
  become: yes
  user:
   name: asusin
   state: present
   createhome: yes
   home: /home/asusin

- name: Check if EPEL repo is already configured.
  become: yes
  stat: path=/etc/yum.repos.d/epel.repo
  register: epel_repofile_result

- name: Install EPEL repo.
  become: yes
  yum:
   name: "https://dl.fedoraproject.org/pub/epel/epel-release-latest-7.noarch.rpm"
   state: present
  register: result
  until: 'result.rc == 0'
  retries: 5
  delay: 10
  when: not epel_repofile_result.stat.exists

- name: Import EPEL GPG key.
  become: yes
  rpm_key:
   key: "/etc/pki/rpm-gpg/RPM-GPG-KEY-EPEL-7"
   state: present
  when: not epel_repofile_result.stat.exists

- name: install all need apps and tools
  become: yes
  yum: 
   name: "{{ item }}" 
   state: present
  with_items:
   - "python34"
   - "python34-setuptools"
   - "python-virtualenv"
   - "git"

- name: install pip with easy_install
  become: yes
  easy_install: 
   name: pip
   executable: easy_install-3.4
   state: latest

- name: clone repo
  become: no
  git:
    repo: 'https://github.com/malkinfedor/telegram_bot.git'
    dest: /home/asusin/telegram-bot
    update: yes
    version: master
    force: yes

- name: create venv 
  become: no
  pip:
    requirements: /home/asusin/telegram-bot/requirements.txt
    virtualenv: /home/asusin/telegram-bot/env
    virtualenv_python: python3.4
