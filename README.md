# telegram_bot

Приложение написано на ЯП python с использованием принципов ООП.
Данная программа состоит из одного класса Monitoring(), который реализует в себе все необходимые методы и свойства для работы бота. Для взаимодействия с telegram используется библиотека python-telegram-bot (https://github.com/python-telegram-bot/python-telegram-bot).
Основные параметры берутся из конф файла. Нужно заметить, что при изменении параметров в файле, требуется перезапуск программы. UPD: изменил код, теперь перезапуск не требуется.
В данной реализации бот шлет сообщения в чат **asusin-channel**.

Класc имеет следующие входные параметры (значения по умолчанию, в случае если они не задаются при создании объекта,
заданы в скобках):


- *frequencyOfSend (60)*
- *frequencyOfCheck (1)*
- *confFile ("config.conf")*


Класс содержит следующие свойства:
- *frequencyOfCheck* (int) - частота опроса ссылки
- *frequencyOfSend* (int) - частота отправки оповещений в телеграм
- *confFile* (str) - имя конф файла, откуда берутся основные параметры.
- *tokenKey* (str)- токен бота(берется из конф файла
- *chatId* (str) - ID чата, в который отправляется уведомление (берется из конф файла)
- *url* (str) - ссылка для опроса (берется из конф файла)
- *urlContext* (str) - контекст для опроса (берется из конф файла)
- *ethalonString* (str) - эталонная строка, котора должна быть в теле ответа в нормальном случае (берется из конф файла)

Класс следующие методы:
- набор сеттеров, для возможности задать значения через внешний интерфейс класса.
- *get_conf_data()* - метод для получения значений переменных из конфигурационного файла.
- *get_body()* - метод, который позволяет получить тело ответа по заданным параметрам.
- *compare_withEthalon()* - позволяет сравнить строку, полученную методом get_body с эталонной.
- *send_to_telegramm()* - позволяет отправить сообщение в телетрам-чат с определенными заданными параметрами.
- *main()* - основной метод, который вызывается в конструкторе и вызывает другие методы данного класса для реализации логики мониторинга.


**Для деплоя данного бота через ansible следует сделать следующее** (работает на centos 7, так как используется systemd)(edited at 29.04.2018 00:07):**
- *git clone -b ansible  --single-branch https://github.com/malkinfedor/telegram_bot.git* - выполнить команду на сервере, откуда планируется запускать ansible playbook
- *cd telegram_bot*
- прописать в файл *inventory.yml* хосты, на которые планируется устанавливать данный бот
- *ansible-playbook -i inventory.yml  deploy.yml* - запустить ansible's playbook который установит необходимые утилиты ОС, приложение, запустит приложение и добавит его в автозагрузку.



